### <u>Batch</u> - является языком программирования, используется для создания файлов сценарий которые можно выполнять на операционной системе Windows, обычно эти файлы имею окончание *.bat или *.cmd. При выполнении они открывают окно "Command Prompt", обычно это окно имеет черный фон, белый шрифт.

### [Ссылка на мини учебник](https://betacode.net/11591/batch-variables)
### [Примеры bat-файлов](https://habr.com/ru/articles/64581/)
### [Вывод на экран](https://pc.ru/articles/kak-soxranit-v-tekstovyj-fajl-vyvod-komandnoj-stroki-windows)

# Основные команды

`rem` или `::` - комментирование строк

`@` - префикс '@ ' означает, что команда не будет выведена на экран(попробуйте его убрать :-) ), сама же команда (echo) выводит текст следующий за ней(см. строку 2), НО, если подать строку "off", все последующие команды будут действовать так, как будто перед ними стоит префикс '@', "echo on", соответственно, выключает этот режим.
Пример: `@rem`  

`echo` - вывод на экран

`echo off` - используется для отключения режима отображения command prompt (напоминание). Данный режим включен (on) по умолчанию. 
Пример: `@echo off`

`pause` - приостановить программу, и ждать когда пользователь нажмет на Enter для продолжения

# Переменные
Batch имеет 2 вида переменных:
1) Переменные объявлены в файле через команду set.
1) Переменная аргумента (Argument variable), передается (pass) снаружи когда файл вызывается для выполнения.

## Типы переменной:
1.  обычно переменная имеет значение строки (string), включая символы после знака = до конца строки (Включая пробелы если есть).  
`set переменная = строка`
1. если вы хотите объявить переменную как число, вам нужно использовать команду set /A  
`set /A переменная = число`
1. флаг "/p", то выводиться значение после символа "=", а переменной задается введенное значение:
```cmd
@echo off
set /p a=Enter str
echo %a%
pause
```

## Переданные переменные при вызове:
Когда идет вызов для выполнения файла batch, вы можете передать (pass) значения в файл. Внутри файла вы можете получить доступ в эти значениячерез переменные %1, %2, %3,... Эти переменные так же называются переменными аргумента (Argument variables).

## Доступ к переменной:
Для получения доступа в значение переменной, вам нужно закрыть (enclosed) заключить ту переменную в скобках со знаками %.  
`echo %переменная%`

## Рамки переменной
Когда командное окно (`Command Window`) открывается, оно начнет сеанс работы (session). Тот сеанс работы завершится когда закроется командное окно. Во время сеанса работы вы можете выполнить один или много файлов batch. Переменные созданные в предыдущих файлах могут быть доступны в следующих файлах. Такие переменные называются глобальными переменными (`Global Variable`). Но вы можете создать локальную переменную (`Local Variable`), локальная переменная существует только в файле определяющей ее, или только существует в коде того файла.  

`Локальные переменные (Local variable)` - объявлены в блоке, начинаются с setlocal и заканчиваются на endlocal.  

# Условия If
Команда if выполняет код, если условие верно (или если поставить not после if, когда НЕ верно), вот операторы сравнения:
P.S. строки нужно брать в кавычки "%str%"=="Hello"

|Название операции|Математический вид|
|-|-|
|equ|=|
|neq|≠|
|lss|<|
|leq|≤|
|gtr|>|
|geq|≥|

Пример кода: 
```cmd
@echo off
set /p a=Enter number
if a gtr 0 echo positive else\
if a equ 0 echo 0 else echo negative
pause
```
> в 3-ей строке, если "a" > 0 выводиться "positive", если равен - 0, в 4-ой если меньше - "negative". Cимвол "\" означает, что команда продолжается на следующей строке

# Команды
`.` - для вывода пустой строки поставьте символ точки после "echo"  
`cls` - очистка консоли  
`>` - (перезапишет) чтобы перенаправить вывод из окна командной строки в файл или на устройство, используется оператор «>» (перезапишет файл)
`>>` - (добавит) чтобы перенаправить вывод из окна командной строки в файл или на устройство, используется оператор «>>»
`chcp "кодировка текущего скрипта"` - включает нужную кодировку в файле  
`title "name"` - меняет заголовок окна на name  
`color ab` - эта команда меняет цвет фона и текста, вместо a и b можно поставить любые шестнадцатеричные цифры(команда не сработает если a = b) см. таблицу ниже. Запись c одной буквой "а" аналогично записи "0a"  
`exit` - досрочно завершает программу

# Циклы FOR

## FOR (по умолчанию)
Синтаксис:
```cmd
@rem set_of_files -  Set of Files
@rem Files separated by standard delimiters.
@rem The parameter name 'variable' must be 1 character
FOR %%variable IN ( set_of_files ) DO command

FOR %%parameter IN ( set_of_files ) DO  (
     command
)
```

## FOR /R
Используется для повторения на списках файлов. Включая файлы в подпапках,.. Называется рекурсией (Recurse).  
Синтаксис:
```cmd
FOR /R [path] %%variable IN ( set_of_file_filters ) DO command

@rem Or:
FOR /R [path] %%variable IN ( set_of_file_filters ) DO (
   command
)
```
<u>[path]</u> : Данный параметр является корневой папкой. Если нет данного параметра"папка включает выполняющийся сценарий файла" или "текущая папка" будет считаться корневой папкой.  
<u>set_of_file_filters</u> : Список фильтров файлов. Напирмер *.txt , *.bat, ... Или точка ( . ) значит все.  
<u>variable</u>: Является названием переменной и должна иметь 1 единственный символ.

> Пример ниже распечатывает список всех файлов *.txt или *.log в папке C:/Windows/System32 (Поиск включает и в подпапках,..)
```cmd
@echo off
FOR /R "C:\Windows\System32" %%f IN (*.txt *.log) DO  (
   echo %%f
)
pause
```

## FOR /D
Цикл FOR /D используется для загрузки списка папок, которые являются подпапками текущей папки.  
Синтаксис:
```cmd
FOR /D [/r] %%variable IN ( set_of_directory_filters ) DO command

@rem Or:
FOR /D [/r] %%parameter IN ( set_of_directory_filters ) DO  (
    command
)
```
<u>set_of_directory_filters</u>: Список фильтров папок (directory filter) как en*, fr*,.. разделены стандартным разделителем (Standard Delimiter).  
<u>[/r]</u>: Это параметр рекурсии (Recurse) и необязателен, если имеется данный параметр подпапки,.. будут участвовать в цикле.  
<u>variable</u>: Является названием переменной и должна иметь 1 единственный символ.

Пример: Перечислить список подпапок C:/Windows.
```cmd
@echo off
C:
cd C:/Windows

FOR /D %%d IN ( * ) DO  (
   echo %%d
)
pause
```

Пример: Перечислить подпапки C:/Windows с названиями начинающимся на "en" или"fr"
```cmd
@echo off
C:
cd C:/Windows

FOR /D /r %%d IN (en* fr*) DO  (
   echo %%d
)
pause
```

## FOR /L
Цикл For /L используется для загрузки на ряде цифр (range of numbers).  
Синтаксис:
```cmd
FOR /L %%variable IN (start, step, end) DO command

@rem Or:
FOR /L %%variable IN (start, step, end) DO  (
     command
)
```
<u>start</u>: Первое значение переменной  
<u>step</u>: После каждого повтора (iteration) значение переменной будет прибавлять 'step'.  
<u>end</u>: Последнее значение.

Пример:  
```cmd
@echo off 
FOR /L %%d IN (1 2 8 ) DO  (
   echo %%d
)
pause
```

## FOR /F
Цикл For /F является сложным циклом, но сильным. Он читает содержание файла или несколько файлов. После анализирует содержание файлов. Содержание фала является текстом, оно будет разделено на несколько маленьких текстов, каждый отрывок текста называетя Token. Правило по умолчанию для разделения основано на пробелах (white space). Но вы можете кастомизировать правило разделения с помощью параметра ["delims=xxx"].  
Цикл For /F так же используется для анализа содержания строки (string), или для выполнения набора команд.  

Синтаксис:
```cmd
FOR /F ["options"] %%variable IN ( set_of_filenames ) DO command

FOR /F ["options"] %%variable IN ( set_of_filenames ) DO (
     command
)
FOR /F ["options"] %%variable IN ("Text string to process") DO command
FOR /F ["options"] %%variable IN ("Text string to process") DO ( 
     command
)
```
<u>set_of_filenames</u>: Список из одного или нескольких файлов.  
<u>options</u>: Опции, например: "delims=, tokens=1,2,4"

|Опция|Описание|
|-|-|
|delims=xxx|Символы разделителя (delimiter character(s)). По умолчанию это пробел (space)|
|skip=n|Количество первых строк, которые будут пропущены в содержании файла. По умолчанию skip=0|
|eol=;|eol (End of Line): Определяет особый символ, который поставлен в начале строки, чтобы отметить эту строку как примечание. Строка примечания будет пропущена программой. По умолчанию это знак точки с запятой ( ; )|
|tokens=n1,n2,n3|Определить нужные позиции (n1, n2, n3, ..), По умолчанию tokens=1 usebackq|

|Tokens|Описание|
|-|-|
|tokens=1,2,4|Индексы 1, 2, 4 заинтересованы.|
|tokens=2-8|Индексы от 2 до 8 заинтересованы|
|tokens=3,*|Индексы 3, 4,5, ... заинтересованы|
|tokens=*|Все индексы заинтересованы|

> Примечание: Названия переменных в цикле имеют только 1 символ.

> Переменная %%i объявлено явным способом на цикле. Переменные %%j, %%k являются переменными, объявленные неявным способом (Названия неявных переменных являются следующие символы явных переменных).

# Массивы (Array)

Массив это ряд последовательных элементов, которые индексированы (index) 0, 1, 2, ....

Для других языков массив имеет фиксированный размер. Но в языке Batch, массив имеет динамический размер, и не имеет атрибут описывающий длину массива (количество элементов массива). И не имеет прямой функции (function), которая поможет вам получить количество элементов массива.

Все элементы массивы должны иметь прикрепленное значение через команду set, не то этот элемент не существует.

```cmd
@echo off
set myarray[0] = Abc
set /A myarray[1] = 234
set myarray[2]=Def

set myarray[0]=A new value
```

## Проверить существование элемента массива `defined`
```cmd
@echo off
set Arr[0]=1000
set Arr[1]=5000
set Arr[2]=3000

if not defined Arr[5] (
   echo Element at 5 does not exists!
)
if defined Arr[1] (
   echo Element at 1 exists!
)
pause
```

## Повторить через элементы массива
```cmd
@echo off
set fruits[0]=Apple
set fruits[1]=Apricot
set fruits[2]=Asparagus
set fruits[3]=Aubergine
set fruits[4]=Banana

set /A i = 0
:my_loop 
    if defined fruits[%i%]  (
        call echo Element At %i% = %%fruits[%i%]%%  
        set /a i = %i% + 1
        goto :my_loop
    ) 
echo Done!
pause
```

## Элементы имеет структуру
В языке Batch, элемент массива может иметь структуру (Structure). Структура это объект с разными атрибутами, например объект представляет человека с 2 атрибутами как firstName, lastName (Имя, Фамилия).

```cmd
@echo off
set persons[0].firstName=Bill
set persons[0].lastName=Gates

set persons[1].firstName=Steve
set persons[1].lastName=Jobs

set persons[2].firstName=Mark
set persons[2].lastName=Zuckerberg 

set persons[3].firstName=Sundar
set persons[3].lastName=Pichai

FOR /L %%i IN (0 1 3) DO  (
   call echo Person At %%i = %%persons[%%i].firstName%% %%persons[%%i].lastName%%
)
pause
```
